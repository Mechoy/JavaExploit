package com.mechoy;

import com.mechoy.controller.YsoController;
import javafx.application.Application;
import javafx.fxml.FXMLLoader;
import javafx.geometry.Rectangle2D;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.scene.image.Image;
import javafx.stage.Screen;
import javafx.stage.Stage;

import javax.imageio.ImageIO;
import java.awt.*;
import java.awt.image.BufferedImage;
import java.io.IOException;
import java.io.InputStream;

public class Main extends Application {

    @Override
    public void start(Stage stage) throws IOException {

        // 使用 ClassLoader 直接加载资源
        InputStream fxmlStream = getClass().getClassLoader().getResourceAsStream("ui/main-view.fxml");

        FXMLLoader fxmlLoader = new FXMLLoader();
        if (fxmlStream != null) {
//            fxmlLoader.setLocation(getClass().getResource("ui/main-view.fxml"));
            Parent root = fxmlLoader.load(fxmlStream);

            // 获取主屏幕的工作区域（去除任务栏和窗口边框）
            Rectangle2D screenWorkArea = Screen.getPrimary().getBounds();
            double workAreaWidth = screenWorkArea.getWidth();
            double workAreaHeight = screenWorkArea.getHeight();

            // 应对不同屏幕大小，进行设置
            Scene scene = new Scene(root, 1100 * (workAreaWidth / 1440.0) , 750 * (workAreaHeight / 900.0));

            stage.setTitle("JavaExploit");

            stage.setScene(scene);

            // 获取控制器实例并设置 Stage
            YsoController controller = fxmlLoader.getController();
            controller.setStage(stage);
//            stage.setResizable(false);

            // 增加图标，增加多个像素的图标，保证兼容性
            stage.getIcons().addAll(
                    new Image(getClass().getClassLoader().getResourceAsStream("ui/icon/seo_16.png")),
                    new Image(getClass().getClassLoader().getResourceAsStream("ui/icon/seo_24.png")),
                    new Image(getClass().getClassLoader().getResourceAsStream("ui/icon/seo_32.png")),
                    new Image(getClass().getClassLoader().getResourceAsStream("ui/icon/seo_64.png")));


            // 设置应用程序图标 针对 Mac系统
            setMacDockIcon();


            stage.show();
        } else {
            System.out.println("FXML 文件未找到");
        }
    }

    /**
     * 用于设置Mac上的图标
     */
    private void setMacDockIcon() {
        // 检查当前操作系统是否是 macOS
        if (System.getProperty("os.name").toLowerCase().contains("mac")) {
            try {
                // 使用 com.apple.eawt.Application 来设置 Dock 图标
                Class<?> applicationClass = Class.forName("com.apple.eawt.Application");
                Object application = applicationClass.getMethod("getApplication").invoke(null);

                InputStream iconStream = getClass().getClassLoader().getResourceAsStream("ui/icon/seo_32.png");
                if (iconStream != null) {
                    BufferedImage image = ImageIO.read(iconStream);
                    applicationClass.getMethod("setDockIconImage", java.awt.Image.class).invoke(application, image);
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }


    public static void main(String[] args) {
        launch();
    }


}